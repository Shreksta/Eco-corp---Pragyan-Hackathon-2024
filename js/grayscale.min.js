/*!
 * Start Bootstrap - ML CO2 Impact v5.0.8 ()
 * Copyright 2013-2023 
 * Licensed under MIT (https://github.com/BlackrockDigital/ml-co2-impact/blob/master/LICENSE)
 */

"use strict";var state,FEATURES=["gpu","provider","region","hours"];function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function selectAndCopyText(e){var t;document.selection?((t=document.body.createTextRange()).moveToElementText(document.getElementById(e)),t.select(),document.execCommand("copy")):window.getSelection&&((t=document.createRange()).selectNode(document.getElementById(e)),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy"))}function findGetParameter(t){var o,i=null;return location.search.substr(1).split("&").forEach(function(e){(o=e.split("="))[0]===t&&(i=decodeURIComponent(o[1]))}),i}function insertParam(e,t,o){t=encodeURI(t),o=encodeURI(o);for(var i,s=e.length;s--;)if((i=e[s].split("="))[0]==t){i[1]=o,e[s]=i.join("=");break}return s<0&&(e[e.length]=[t,o].join("=")),e}function sc(e){$("html,body").animate({scrollTop:$("#"+e).offset().top-parseInt($("#"+e).height()/1.2)},"slow")}const setImports=(e,t,i)=>{const s="dev"===e;$(t).each((e,t)=>{var o=$(t).attr(i);o&&0<=o.indexOf("...")&&$(t).attr(i,s?o.split("...")[1]:"/impact"+o.split("...")[1])})},getValues=()=>{var e=$("#compute-gpu option:selected").val(),t=$("#compute-provider option:selected").val(),o="custom"!==t?$("#compute-region option:selected").val():null,i="custom"!==t?null:parseFloat($("#compute-custom-impact").val()),s="custom"!==t?null:parseFloat($("#compute-custom-offset").val());return{gpu:e,provider:t,region:o,hours:parseFloat($("#compute-hours").val()),customImpact:i,customOffset:s}},scrollToBottomResultCard=()=>{var e=$("#result-card").offset().top+$("#result-card").outerHeight()-$(window).height()+50;$("html, body").animate({scrollTop:e},1e3,"easeInOutExpo")},growDivOnArrowClick=(e,t)=>{$(e).click(function(){var o;$(this).find(".arrow-icon").hasClass("open")?($(t).height(0),setTimeout(()=>{isBottomVisible(50)||scrollToBottomResultCard()},500)):(o=0,$(t).children().each((e,t)=>{o+=$(t).innerHeight()}),$(t).height(o),setTimeout(()=>{$(window).height()>$("#result-card").outerHeight()+150&&!isBottomVisible()&&scrollToBottomResultCard()},500)),$(this).find(".arrow-icon").toggleClass("open")})},growDivOnArrowClickLearn=(e,t)=>{$(e).click(function(){var o;$(this).find(".arrow-icon").hasClass("open")?$(this).siblings(t).height(0):(o=0,$(this).siblings(t).children().each((e,t)=>{o+=$(t).innerHeight()}),$(this).siblings(t).height(o)),$(this).find(".arrow-icon").toggleClass("open")})},check=(e,o)=>{switch($("#compute-hours").css("border",""),e){case"gpu":return state.gpus.filter((e,t)=>e.name===o).length;case"hours":return Number.isInteger(o)&&0<o&&o<1e6;case"provider":return state.providers.filter((e,t)=>e.name===o).length;case"region":return state.regions.filter((e,t)=>e.name===o).length;default:return!0}},checkForm=()=>{var e=getValues(),{}=e;let o=!1;return FEATURES.forEach((e,t)=>{check(t,e)||(fail(t),o=!0)}),o?null:e},twoDigits=e=>Number(Number(e).toFixed(2)),toDigits=(e,t)=>Number(Number(e).toFixed(t)),fillLatexTemplate=(e,t,o,i,s,r,a,n)=>{e?$("#template-text-offset").show():$("#template-text-offset").hide(),$("#template-provider").text(e||"a private infrastructure"),$("#template-region").text(t?" in region "+t:""),$("#template-region-efficiency").text(n),$("#template-hours").text(o),$("#template-gpu").text(i),$("#template-gpu-power").text(s),$("#template-emissions").text(r),$("#template-percentage-offset").text(a)},setDetails=e=>{var{gpu:t,hours:o,provider:i,region:s,customImpact:r,customOffset:a}=e,n=twoDigits(state.gpus[t].watt*o/1e3),r=Number.isFinite(r)?r:twoDigits(state.providers[i][s].impact/1e3),l=twoDigits(n*r),c=Number.isFinite(a)?twoDigits(l*a/100):twoDigits(l*state.providers[i][s].offsetRatio/100),p=Number.isFinite(a)?twoDigits(a):twoDigits(state.providers[i][s].offsetRatio),m=Number.isFinite(a)?"":state.providers[i][s].providerName,u=Number.isFinite(a)?"":state.providers[i].__min.region,i=Number.isFinite(a)?"":state.providers[i][u];console.log("Computation details:"+Object.entries(e).map(e=>{var[e,t]=e;return`
  â€¢ ${e}: `+t}).join("")),fillLatexTemplate(m,s,o,t,state.gpus[t].watt,l,p,r),fillComparisonTable(l),$("#comparison-result-co2").text(l),$("#offset-value").text(c),$("#details-counts").html(`
  ${state.gpus[t].watt}W x ${o}h = <strong>${n} kWh</strong> x ${r}
  kg  eq. CO<sub>2</sub>/kWh = <strong>${l} kg eq. CO<sub>2</sub></strong>
  `),Number.isFinite(a)?($("#details-min-region").html(""),$("#details-alternative").html(""),$("#details-alternative-content").show(),$("#compute-carbon-offset-title").html("Carbon offset")):($("#compute-carbon-offset-title").html("Carbon Already Offset by Provider"),s!==u?(e=twoDigits(n*i.impact/1e3),$("#details-min-selected").hide(),$("#details-alternative").html(`
        Had this model been run in ${m}'s <strong>${i.regionName}</strong> region,
        the carbon emitted would have been of <strong>${e}</strong> kg eq. CO<sub>2</sub>
        `),$("#details-alternative").show()):($("#details-min-selected").show(),$("#details-alternative").hide(),$("#details-min-region").html(`
        You have selected ${m}'s cleanest region!
        `)))},scientificNotation=(e,t)=>{e=e.toExponential()+"";let o=e.split(".")[1].split("e")[0];o=o.slice(0,t);var i=e.split("e")[1];let s=parseFloat(e.split(".")[0]+"."+o);return"+0"===i?s=toDigits(+s,t):"+1"===i?s=toDigits(10*s,t):"+2"===i?s=toDigits(100*s,t):"-1"===i?s=toDigits(.1*s,t):"-2"===i?s=toDigits(.01*s,t):s+=` <small>x</small>10<sup>${i.replace("+","")}</sup>`,s},fillComparisonTable=e=>{$("#emitted-value").text(e);var t=scientificNotation(e/(.398/1.609344),2),o=scientificNotation(e/1.9951838150000005,2),e=scientificNotation(e/60,2);$("#comparison-result-driven").html(t),$("#comparison-result-coal").html(o),$("#comparison-result-forest").html(e)},isBottomVisible=e=>{e=e||0;return $("#result-card").offset().top+$("#result-card").outerHeight()+e<$(window).scrollTop()+$(window).height()},submitCompute=e=>{$("#result-card").hide(),$("#comparison-row").hide(),$("#details-content").height(0),$("#details-banner .arrow-icon").removeClass("open"),$(".spinner-border").show();var t=getValues();t&&(setDetails(t),state.current=t,setTimeout(()=>{$(".spinner-border").hide(),$("#result-card").fadeIn(),$("#comparison-row").fadeIn(),$("#compute-carbon-emitted-title").height($("#compute-carbon-offset-title").height()),($(window).width()<769||!isBottomVisible())&&scrollToBottomResultCard()},getRandomInt(500,1500)))},setRegions=t=>{if("custom"===t)$("#compute-region-div").fadeOut(()=>{$(".custom-hidable").fadeIn()});else{$("#compute-region-div").is(":visible")||$(".custom-hidable").fadeOut(()=>{$("#compute-region-div").fadeIn()}),$("#compute-region").html("");var o=[];for(const s in state.providers[t])if(state.providers[t].hasOwnProperty(s)&&"__min"!==s){let e=state.providers[t][s]["regionName"];e=e||s,o.push({region:s,regionName:e})}o.sort((e,t)=>e.regionName>t.regionName?1:t.regionName>e.regionName?-1:0);for(const r of o){var{regionName:e,region:i}=r;$("#compute-region").append(`<option value="${i}">${e}</option>`)}}},setInputs=()=>{for(const i of Object.keys(state.gpus).sort()){var e="Tesla V100"===i?"selected":"";$("#compute-gpu").append(`<option ${e} value="${i}">${i}</option>`)}let t,o=0;for(const s in state.providers)if(0==o&&(t=s),o++,state.providers.hasOwnProperty(s)){let e;for(const r in state.providers[s])if(state.providers[s].hasOwnProperty(r)&&"__min"!==r){e=state.providers[s][r].providerName;break}$("#compute-provider").append(`<option value="${s}">${e}</option>`)}$("#compute-provider").append('<option value="custom">Private Infrastructure</option>'),setRegions(t)};!async function(o){o('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var t=o(this.hash);if((t=t.length?t:o("[name="+this.hash.slice(1)+"]")).length){o("html, body").animate({scrollTop:t.offset().top-70},1e3,"easeInOutExpo");let e=window.location.pathname;return"/"!==e[e.length-1]&&(e+="/"),window.history.pushState("","",e+this.hash),!1}}}),o(".js-scroll-trigger").click(function(){o(".navbar-collapse").collapse("hide")});function e(){100<o("#mainNav").offset().top?o("#mainNav").addClass("navbar-shrink"):o("#mainNav").removeClass("navbar-shrink")}lozad().observe();e(),o(window).scroll(e),state=await getData(),o("#compute-loader").fadeOut(()=>{o("#compute-container").fadeIn()}),setInputs(),setImports(serveFrom,"a","href"),setImports(serveFrom,"img","src"),o("#compute-provider").change(e=>{var t=o("#compute-provider option:selected").val();setRegions(t)}),o("#compute-form").submit(e=>(submitCompute(),!1)),o(".details-summary").each((e,t)=>{e%2==0||o(window).width()<770?o(t).append(o(`
      <a class="arrow-icon arrow-learn-even" title="Learn more">
      <span class="left-bar"></span>
      <span class="right-bar"></span>
      </a>
      `)):(o(t).css("justify-content","flex-end"),o(t).prepend(o(`
      <a class="arrow-icon arrow-learn-odd" title="Learn more">
      <span class="left-bar"></span>
      <span class="right-bar"></span>
      </a>
      `)))}),growDivOnArrowClickLearn(".details-summary",".summary-content"),growDivOnArrowClick("#details-banner","#details-content"),o("#copy-template-btn").click(()=>{selectAndCopyText("template-code"),o("#copy-template-feedback").fadeIn(()=>{setTimeout(()=>{o("#copy-template-feedback").fadeOut()},1e3)})})}(jQuery);